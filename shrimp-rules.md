# Development Guidelines

This document provides specific guidelines for AI Agents performing development tasks in the `mcp-shrimp-task-manager` project.

## 1. Project Overview

- **Project Name**: `mcp-shrimp-task-manager`
- **Purpose**: A task management tool designed for AI Agents, emphasizing chain of thought, reflection, and style consistency. It converts natural language into structured development tasks and features dependency tracking and iterative optimization.
- **Technology Stack**:
  - Main Language: TypeScript
  - Execution Environment: Node.js (ES Module)
  - Main Frameworks/Libraries: Express.js (for possible API or WebGUI), Zod (for data validation)
  - Package Manager: npm
- **Core Features**:
  - Natural language task parsing
  - Structured task generation and management
  - Task dependency tracking
  - Task execution and validation assistance
  - Integration with AI Agent's thought processes

## 2. Project Architecture

- **Main Source Code Directory**: `src/`
  - `src/index.ts`: Main application entry point or module export point. **Modifying this file requires careful assessment of the impact scope.**
  - `src/utils/`: General utility functions.
  - `src/types/`: TypeScript type definitions. **When adding or modifying types, ensure consistency with Zod schemas (if applicable).**
  - `src/tools/`: Project-specific tools or modules for integration with external services.
  - `src/models/`: Data model definitions (possibly related to Zod schemas).
  - `src/prompts/`: Prompt templates for AI interaction. **When modifying or adding prompts, consider the potential impact on AI Agent behavior.**
  - `src/public/`: WebGUI or other static resources.
  - `src/tests/`: Unit tests and integration tests.
- **Compilation Output Directory**: `dist/` (This directory is automatically generated by `tsc`. **Manual modification of this directory's content is prohibited.**).
- **Configuration Files**:
  - `package.json`: Project dependencies and scripts. **After adding dependencies, `npm install` must be executed.**
  - `tsconfig.json`: TypeScript compilation settings. **Under normal circumstances, do not modify the `"strict": true` setting.**
  - `.env.example` & `.env`: Environment variable settings. **Sensitive information must not be committed to version control.**
- **Documentation**:
  - `README.md`: Main project documentation.
  - `docs/`: May contain more detailed architecture, API documentation, etc.
  - `CHANGELOG.md`: Record of version changes. **Must be updated before releasing each new version.**
  - `data/WebGUI.md`: Contains the link to the Task Manager UI.

## 3. Code Specifications

### 3.1. Naming Conventions

- **Variables and Functions**: Use camelCase.
  - _Example (Do)_: `const taskName = "example"; function processTask() {}`
  - _Example (Don't)_: `const Task_Name = "example"; function Process_Task() {}`
- **Classes and Interfaces**: Use PascalCase.
  - _Example (Do)_: `class TaskManager {}; interface ITaskOptions {}`
  - _Example (Don't)_: `class taskManager {}; interface iTaskOptions {}`
- **File Names**: Use camelCase or kebab-case for `.ts` files.
  - _Example (Do)_: `taskProcessor.ts`, `task-utils.ts`
  - _Example (Don't)_: `TaskProcessor.ts`, `task_utils.ts`
- **Constants**: Use UPPER_SNAKE_CASE.
  - _Example (Do)_: `const MAX_RETRIES = 3;`
  - _Example (Don't)_: `const maxRetries = 3;`

### 3.2. Formatting Requirements

- **Indentation**: Use 2 spaces for indentation. **Tabs are prohibited.**
- **Semicolons**: Semicolons must be used at the end of every statement.
- **Quotes**: Prefer single quotes (`'`) for strings, unless the string itself contains single quotes.
  - _Example (Do)_: `const message = 'Hello World'; const complex = "It\\'s complex";`
  - _Example (Don't)_: `const message = "Hello World";`
- **Maximum Line Length**: Recommended not to exceed 120 characters.
- **Comments**:
  - Use `//` for single-line comments.
  - Use `/* ... */` for multi-line comments.
  - JSDoc-style comments should be used for public functions, classes, and methods.
    - _Example (Do)_:
      ```typescript
      /**
       * Processes a given task.
       * @param taskId The ID of the task to process.
       * @returns True if successful, false otherwise.
       */
      function processTaskById(taskId: string): boolean {
        // implementation
        return true;
      }
      ```

### 3.3. TypeScript Specific Guidelines

- **Type Annotations**: All function parameters, return values, and variable declarations should have explicit type annotations. **The `any` type is prohibited, except in very specific and unavoidable situations, which require a comment explaining the reason.**
  - _Example (Do)_: `function greet(name: string): string { return \`Hello, ${name}\`; }`
  - _Example (Don't)_: `function greet(name): any { return "Hello, " + name; }`
- **Interfaces and Type Aliases**: Prefer interfaces for defining object shapes and type aliases for defining union types, tuples, or other complex types.
- **ES Modules**: Use `import` and `export` syntax.
  - _Example (Do)_: `import { Task } from './models/task'; export class TaskService {}`
  - _Example (Don't)_: `const Task = require('./models/task'); module.exports = TaskService;`
- **Strict Mode**: The project has `"strict": true` enabled. All TypeScript strict mode errors must be resolved.

## 4. Feature Implementation Guidelines

### 4.1. General Principles

- **Single Responsibility Principle (SRP)**: Each function and class should be responsible for only one piece of functionality.
- **Keep It Simple, Stupid (KISS)**: Avoid overly complex solutions.
- **Reusability**: Extract common logic into reusable functions or classes, placing them in `src/utils/` or relevant modules.
- **Error Handling**:
  - Use `try...catch` to handle expected errors.
  - Provide clear error messages for critical operations.
  - Consider using custom error classes for richer error information.
- **Logging**:
  - Add logging for critical operations, error handling, and important state changes.
  - Consider using structured logging.
  - **Do not log sensitive information (e.g., passwords, API Keys).**

### 4.2. Zod Usage

- Data structures defined in `src/models/` or `src/types/` should primarily use Zod schemas for definition and validation.
- Zod schemas should be kept in sync with TypeScript types. `z.infer<typeof schema>` can be used to generate types.

  - _Example (Do)_:

    ```typescript
    import { z } from "zod";

    export const TaskSchema = z.object({
      id: z.string().uuid(),
      name: z.string().min(1),
      description: z.string().optional(),
    });

    export type Task = z.infer<typeof TaskSchema>;
    ```

### 4.3. Express.js Usage (if API/WebGUI exists)

- Route definitions should be clear and follow RESTful principles (if an API).
- Middleware should be effectively organized (e.g., error handling middleware, logging middleware).
- All external input (request parameters, body, query) **must** be validated using Zod or a similar mechanism.

## 5. Framework/Plugin/Third-Party Library Usage Guidelines

- **Adding Dependencies**:
  - **Must** first evaluate the necessity, maintenance status, and security of the dependency.
  - Use `npm install <package-name>` (for runtime dependencies) or `npm install --save-dev <package-name>` (for development dependencies).
  - **Must** specify explicit version ranges in `package.json` (e.g., `^1.2.3` or `~1.2.3`), avoid using `*`.
- **Updating Dependencies**: Regularly check and update dependencies to the latest stable versions for security patches and new features. Assess potential breaking changes before updating.
- **Removing Dependencies**: If a dependency is no longer needed, remove it using `npm uninstall <package-name>` and remove related references from the code.

## 6. Workflow Guidelines

### 6.1. Development Process

1.  **Understand Task**: Carefully read the task description, requirements, and acceptance criteria.
2.  **Branch Management**: Create a new feature branch from the latest `main` (or `develop`) branch. Branch names should be concise and clear, e.g., `feature/add-task-editing` or `fix/login-bug`.
3.  **Coding and Testing**:
    - Code according to these guidelines.
    - **Must** write unit tests (stored in `src/tests/`) for new features or bug fixes.
    - Run `npm run build` to ensure the code compiles successfully.
    - Run `npm run dev` or `npm run start` locally for testing.
4.  **Code Committing**:
    - Git commit messages should follow Conventional Commits guidelines (e.g., `feat: add user authentication`, `fix: resolve issue with task sorting`).
    - **Do not commit code containing `console.log` or other debugging messages to the main branch.**
5.  **Pull Request (PR)**:
    - Push the feature branch to the remote repository and create a Pull Request to the `main` (or `develop`) branch.
    - The PR description should clearly explain the changes and the reason for them.
6.  **Code Review**: Wait for other developers or AI Agents to conduct a code review.
7.  **Merge and Deploy**: After the code review is passed, merge the PR. Deployment process depends on project settings.

### 6.2. Version Control (Git)

- **Main Branches**:
  - `main`: Represents the stable and deployable product version.
  - `develop` (if used): Represents the latest in-development version.
- **Commit Frequency**: Recommended to make small, frequent commits of meaningful changes.
- **Conflict Resolution**: When merging or rebasing branches, if conflicts occur, they **must** be carefully resolved to ensure code correctness and integrity.

### 6.3. CHANGELOG Updates

- Before releasing a new version, `CHANGELOG.md` **must** be updated.
- The record should include the version number, release date, and a list of new features, bug fixes, and major changes.

## 7. Key File Interaction Guidelines

- **Modifying `src/types/` or `src/models/` (especially Zod schemas)**:
  - **Must** check and update all files referencing these types or schemas to ensure type consistency.
  - **Must** re-run relevant tests.
- **Modifying `src/index.ts`**:
  - If the module's exported API is modified, **must** check all projects or files depending on this module and adjust accordingly.
- **Modifying `package.json` (especially `dependencies` or `scripts`)**:
  - **Must** notify team members or relevant AI Agents to run `npm install`.
  - If `scripts` are modified, ensure CI/CD processes (if any) are also updated.
- **Modifying `.env.example`**:
  - **Must** synchronously update `.env` files in all development environments and notify team members.
- **Modifying `README.md` or documents in `docs/`**:
  - If changes involve core features or usage, **must** ensure the accuracy and timeliness of the documentation.

## 8. AI Decision-Making Guidelines

### 8.1. Handling Ambiguous Requests

- When receiving ambiguous development instructions (e.g., "optimize task list display"):
  1.  **Attempt to Clarify**: If possible, request more specific details or expected outcomes from the user or task initiator.
  2.  **Analyze Context**: Examine relevant code (`src/`), existing UI (if any), related issues (if any) to infer possible intent.
  3.  **Propose Solutions**: Based on the analysis, propose 1-2 concrete implementation plans, explaining their pros, cons, and estimated effort.
  4.  **Await Confirmation**: Do not make large-scale code modifications before receiving clear instructions.

### 8.2. Error/Exception Handling Strategy

- **Priority**:
  1.  **User Experience**: Avoid program crashes, provide friendly error messages.
  2.  **Data Integrity**: Ensure errors do not lead to data corruption or inconsistency.
  3.  **System Stability**: Log detailed error information for troubleshooting.
- **Choices**:
  - For predictable errors (e.g., invalid user input), handle them within the context of the operation and provide feedback.
  - For unexpected system errors, catch, log, and possibly rethrow or trigger a global error handling mechanism.

### 8.3. Dependency Selection

- When needing to introduce new third-party libraries:
  1.  **Check Existing**: Confirm if there are similar libraries already in the project that can meet the needs.
  2.  **Evaluate Options**:
      - **Activity and Community Support**: Choose well-maintained libraries with active communities.
      - **Lightweight**: Avoid introducing overly large or feature-redundant libraries.
      - **Security**: Check for known security vulnerabilities.
      - **License**: Ensure compatibility with the project's license.
  3.  **Minimization Principle**: Only introduce libraries that are genuinely needed.

## 9. Prohibitions

- **Do not directly modify any files in the `dist/` directory.** This directory contains compiled output.
- **Do not assume new dependencies are available without running `npm install`.**
- **Do not commit untested or unfinished code directly to the main branch (`main` or `develop`).** Feature branches must be used.
- **Do not commit code containing API Keys, passwords, or other sensitive information to the version control system.** Use `.env` files to manage such information.
- **Do not significantly modify core architecture or public APIs without notification or consent.**
- **Do not ignore TypeScript type errors.** All errors reported by `tsc` must be resolved.
- **Do not use the `any` type without a valid reason and a comment.**
- **Do not leave a large amount of `console.log` or other temporary debugging code in the codebase.**
- **Do not release a new version without updating `CHANGELOG.md`.**
- **Do not introduce third-party libraries incompatible with the project's MIT license terms.**

## 10. Updating This Guideline Document (`shrimp-rules.md`)

- When the project's technology stack, core architecture, main workflow, or important guidelines change, this document **must** be updated synchronously.
- Update requests should clearly indicate the sections and content that need to be changed.
- If a vague "update rules" instruction is received, the AI Agent **must**:
  1.  Autonomously analyze changes in the current codebase (e.g., `git diff`, recent commits).
  2.  Compare the existing `shrimp-rules.md` with the project's current state to find inconsistent or outdated rules.
  3.  List the inferred update points and their reasons in the `process_thought` stage.
  4.  Propose specific modifications or directly edit this document.
  5.  **Strictly prohibit** seeking clarification from the user for vague requests before performing autonomous analysis.

---

This development guideline aims to ensure that AI Agents can participate efficiently, consistently, and securely in the development of the `mcp-shrimp-task-manager` project.
